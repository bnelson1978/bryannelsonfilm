---
import { getCollection } from "astro:content";

const CATEGORY_ORDER = [
  "Human Interest",
  "Space & Astronomy",
  "Health Sciences",
  "Arts & Culture",
  "Nature & Environment",
  "Education",
  "Innovation & Technology",
];

const films = await getCollection("films");
const sorted = films.sort((a, b) => (b.data.year ?? 0) - (a.data.year ?? 0));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Bryan Nelson — Documentary Filmmaker</title>
  </head>
  <body>
    <main class="wrap">
      <header class="hero">
        <div>
          <h1>Bryan Nelson</h1>
          <p class="sub">Documentary Filmmaker • Founder, Catachresis Film</p>
        </div>
        <nav class="actions">
          <a href="/contact" class="btn">Contact</a>
          <a href="/about" class="btn ghost">About</a>
        </nav>
      </header>

      <section class="filters" aria-label="Film categories">
        <button class="chip is-active" data-cat="All">All</button>
        {CATEGORY_ORDER.map((c) => <button class="chip" data-cat={c}>{c}</button>)}
      </section>

      <section class="grid" id="filmGrid">
        {sorted.map((film) => (
          <a
            class="card"
            href={`/films/${film.slug}`}
            data-cats={film.data.categories.join("|")}
          >
            <div class="thumb">
              <img src={film.data.thumbnail} alt={film.data.title} loading="lazy" />
            </div>
            <div class="meta">
              <div class="title">{film.data.title}</div>
              <div class="kicker">
                <span>{film.data.categories[0]}</span>
                {film.data.year ? <span> • {film.data.year}</span> : null}
              </div>
            </div>
          </a>
        ))}
      </section>
    </main>

    <script>
      const chips = Array.from(document.querySelectorAll(".chip"));
      const cards = Array.from(document.querySelectorAll(".card"));

      function setActive(cat) {
        chips.forEach((c) => c.classList.toggle("is-active", c.dataset.cat === cat));
        cards.forEach((card) => {
          const cats = (card.dataset.cats || "").split("|");
          const show = cat === "All" || cats.includes(cat);
          card.style.display = show ? "" : "none";
        });
      }

      chips.forEach((chip) => {
        chip.addEventListener("click", () => setActive(chip.dataset.cat));
      });
    </script>

    <style>
      :global(body) { margin:0; background:#070707; color:#fff; font-family: ui-sans-serif, system-ui; }
      .wrap { max-width: 1100px; margin: 48px auto; padding: 0 20px; }
      .hero { display:flex; align-items:flex-end; justify-content:space-between; gap:16px; margin-bottom: 18px; }
      h1 { margin:0; font-size: 2.2rem; }
      .sub { margin:6px 0 0; color:#bbb; }
      .actions { display:flex; gap:10px; }
      .btn { border:1px solid #222; padding:10px 14px; border-radius:999px; color:#fff; text-decoration:none; background:#111; }
      .btn.ghost { background:transparent; color:#ddd; }
      .filters { display:flex; flex-wrap:wrap; gap:10px; margin: 18px 0 22px; }
      .chip { border:1px solid #222; background:#0f0f0f; color:#ddd; padding:10px 12px; border-radius:999px; cursor:pointer; }
      .chip.is-active { background:#1a1a1a; color:#fff; border-color:#333; }
      .grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:18px; }
      .card { text-decoration:none; color:inherit; border:1px solid #151515; background:#0b0b0b; }
      .thumb { aspect-ratio: 16 / 9; overflow:hidden; background:#111; }
      .thumb img { width:100%; height:100%; object-fit:cover; }
      .meta { padding:12px; }
      .kicker { margin-top:6px; color:#aaa; font-size: 0.9rem; }
      @media (max-width: 900px) { .grid { grid-template-columns: repeat(2, 1fr); } }
      @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
    </style>
  </body>
</html>
